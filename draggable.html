<!DOCTYPE html>
<html>
<head>
  <title>Draggable Elements</title>
<!--
// Copyright (C) 2020 by Henry Kroll, thenerdshow.com
/* Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License. */ //-->
<!--   <script name="prefixFree" src="https://thenerdshow.com/js/prefixfree.min.js"></script>
  <script name="prefixFree" src="https://thenerdshow.com/js/prefixfree.dynamic-dom.min.js"></script>

  <link rel="stylesheet" href="https://thenerdshow.com/css/github.css">
  <script src="https://thenerdshow.com/js/highlight.pack.js"></script>
  <script>
  hljs.initHighlightingOnLoad();
  </script> -->
  <script type="module" src="kickass.js"></script>

  <style id="dragStyles">
  /* a container class to handle drag events */
  .draggable {
     position: absolute;
     right: 10px;
  }
  /* a titlebar class to move a parent around with it */
  .titlebar {
     cursor: move;
     padding: 10px;
     background-color: #2196F3;
     color: #fff;
     font-weight: bold;
  }
  /* a drag class to move elements without a titlebar */
  .drag {
      cursor: move;
  }
  </style>
  <style id="widgetStyles">
  .widget {
     background-color: #f1f1f1;
     text-align: center;
     border: 1px solid #888;
     position: relative;
  }
  .widget:hover {
     box-shadow: 5px 10px 8px #222;
  }
  </style>
</head>
<body>
  <div data-href="about.html"></div>
  
  <h2 data-echo="title"></h2>
  
  <p>This tutorial walks through creating some basic elements or widgets and making them draggable.</p>
  
  <p>Although there are other drag and move scripts out there, this one is easy to use, modular, and compact. It works with mice, touch screens, and tablets. It supports multiple widgets or elements on a page. Elements may be configured via CSS to be enabled for moving/dragging either via a title bar, or by clicking on the body of the element. That's important because some widgets contain interactive elements that dragging might interfere with. We also added events so scripts can do stuff when they move.</p>
  
  <h2>CSS Classes</h2>
  
  <p>First let's define some CSS classes to identify which elements can move. Add this to a page to override the default draggable stylesheet that will be automatically added when using kickass scripts. We define three classes, a parent <b>draggable</b> class, a <b>titlebar</b> class, and a separate <b>drag</b> class.</p>
  
  <p>*<b>Note</b> that CSS no longer needs to include <a href="https://developer.mozilla.org/en-US/docs/Glossary/Vendor_Prefix">vendor-specific CSS prefixes</a>, such as -moz- and -ms-, becasue kickass scripts automatically pull in <a href="http://leaverou.github.io/prefixfree/">-prefix-free</a> with <a href="http://leaverou.github.io/prefixfree/#plugins">dynamic DOM</a> plugin to take care of that. Enjoy!</p>
  
  <div class="draggable">
     
    <div id="mydiv" class="widget">
      <div class="titlebar">
        Drag this title bar.
      </div>
      <p>This div is only</p>
      <p>dragable via</p>
      <p>the title bar.</p>
    </div>
    
    <div class="widget drag">
      <p>Drag this separately.</p>
    </div>
    
    <div style="border-radius: 50%" class="widget drag">
       <p>Oval</p>
    </div>
    
  </div>

<script id="dragElements">
  /* Draggable Elements: Drag and dragElements elements with mouse or gestures
     Improvements over the original include titlebars, zIndex, events */

     //Originally from:
     //www.kirupa.com/html5/drag.htm
     //www.kirupa.com/html5/examples/drag_multiple.htm

  function dragElements(e){
    var container = document.querySelector(e);
    var activeItem = null, ca = container.addEventListener;
    
    ca("touchstart", dragStart, false);
    ca("touchend", dragEnd, false);
    ca("touchmove", drag, false);

    ca("mousedown", dragStart, false);
    ca("mouseup", dragEnd, false);
    ca("mousemove", drag, false);
    
    //create some events
    var startmove = new CustomEvent('startmove');
    var moving = new CustomEvent('moving');
    var stopmove = new CustomEvent('stopmove');

    function dragStart(e) {
      var et = e.target;
      //activeItem is either a parent of a titlebar, or drag
      if (et.classList.contains("titlebar")){ et = et.parentElement; }
      else {//find something to drag
         while (!et.classList.contains("drag")){
            //if nothing is drag, we're done here
            if (!et.parentElement || et === container) return;
            et = et.parentElement; //keep looking
         }
      } activeItem = et;
      
      //move on top of other elements
      for (i = container.children.length; i--;)
         container.children[i].style.zIndex="";
      activeItem.style.zIndex="1";

       if (!activeItem.xOffset) { activeItem.xOffset = 0; }
       if (!activeItem.yOffset) { activeItem.yOffset = 0; }
      
       if (e.type === "touchstart") {
         activeItem.initialX = e.touches[0].clientX - activeItem.xOffset;
         activeItem.initialY = e.touches[0].clientY - activeItem.yOffset;
       } else {
         //console.log("Dragging", e.etet.tagName);
         activeItem.initialX = e.clientX - activeItem.xOffset;
         activeItem.initialY = e.clientY - activeItem.yOffset;
       }
        activeItem.dispatchEvent(startmove);
    }

    function dragEnd(e) {
      if (activeItem) {
        activeItem.initialX = activeItem.currentX;
        activeItem.initialY = activeItem.currentY;
        activeItem.dispatchEvent(stopmove);
      }
      activeItem = null;
    }

    function drag(e) {
      if (activeItem) {
        if (e.type === "touchmove") {
          e.preventDefault();
          activeItem.currentX = e.touches[0].clientX - activeItem.initialX;
          activeItem.currentY = e.touches[0].clientY - activeItem.initialY;
        } else {
          activeItem.currentX = e.clientX - activeItem.initialX;
          activeItem.currentY = e.clientY - activeItem.initialY;
        }
        activeItem.xOffset = activeItem.currentX;
        activeItem.yOffset = activeItem.currentY;
        setTranslate(activeItem.currentX, activeItem.currentY, activeItem);
        activeItem.dispatchEvent(moving);
      }
    }

    function setTranslate(xPos, yPos, el) {
      el.style.transform = "translate(" + xPos + "px, " + yPos + "px)";
    }
  }
  window.addEventListener('load', dragElements(".draggable"));
  </script> 
  <pre data-code="style#dragStyles"></pre>
  
  <h2 style="clear:both">Draggable Elements</h2>
    
    <p>Create a parent element such as a <b>div</b> to hold all draggable widgets and assign a <b>class="draggable"</b> to it. This serves as a container to receive drag and move events. We could assign <b>class="draggable"</b> to the document's <b>body</b> element. And in fact that's what the <b>widgetize()</b> function does. But there may be side effects if you want to use drag and drop elsewhere on the page. Widgets do not have to stay inside the draggable (They can use absolute positioning). Here, we define two dragable elements. One of them is draggable because it has a <b>titlebar</b>. The others have no titlebar; so the only way to make them draggable is to add a <b>drag</b> class.</p> 

  <pre data-code="div.draggable"></pre>
  
  <h2 style="clear:both">JavaScript</h2>
  <p>
  Here is the javascript to move things around.</p>
  <pre data-code="script#dragElements"></pre>
  
  <p style="clear:both"><br>
   We transfered the scripts from this page into a separate javascript file, named "dragElements.js". That way, we don't need to cut and paste all these scripts into every page where they are required. We can simply include them like this.</p>
  
  <pre><code>&lt;script type="module" src="js/dragElements.js"&gt;&lt;/script&gt;</code></pre>
  
 
  <h2>Custom events.</h2>
  
  <p>The above script adds three custom events, <b>startmove</b>, <b>moving</b>, and <b>stopmove</b>. Let's add listeners to these events so that when we move them they look orange. We could do other things such as get their positions when they are set down for something like a chess game.</p>
  
  <script id="shadows">
   var divs = document.querySelectorAll(".widget");
   divs[0].addEventListener("startmove",
      e=>e.target.style.background="orange");
   divs[1].addEventListener("startmove",
      e=>e.target.style.background="orange");
   var divs = document.querySelectorAll(".widget");
   divs[0].addEventListener("stopmove",
      e=>e.target.style.background="");
   divs[1].addEventListener("stopmove",
      e=>e.target.style.background="");
  </script> 
  
  <pre data-code="script#shadows"></pre>
  
  <h2 style="clear:both">Wrapping Up</h2>
  <p>
  Well, that's it. We defined CSS classes for dragable objects, one that moves with a titlebar, and one that doesn't. We created a page to display them. We defined elements that can move with the mouse or with tablet and phone gestures. Then we added events to the dragable elements to color them as they move. If this tutorial was helpful, please subcribe for more updates.</p>
</body>
</html>
